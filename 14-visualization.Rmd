# Visualising and exporting data{-}

```{r, include = FALSE}
source("common.R")
```

This Chapter is intended for programmers and experts who would like to extend the capabilities of `sits` by including new data sources, machine learning algorithms, exporting data to be used in Python or QGIS, or including new display colors. 


## How colors work in sits{-}

In examples provided in the book, the color legend is taken from a predefined color table provided by `sits`. This default color table is displayed using `sits_colors_show()`. This color definition file assigns colors to 99 class names, including the IPCC and IGBP land classes. 

```{r, tidy = "styler", out.width = "100%", out.height = "100%", echo = FALSE, fig.align="center", fig.cap="Default colors used in the sits package (Source: Authors)."}
# Display default `sits` colors
sits_colors_show()
```

The color table can be extended or adjusted by accessing and modifying the default color table, which is retrieved using `sits_colors()`.

```{r}
# Retrieve the color table
color_tb <- sits_colors()
# Show the color table
color_tb
```

The default color table can be redefined using `sits_colors_set()`. As an example of a user-defined color table, consider a definition that covers level 1 of the Anderson Classification System used in the US National Land Cover Data, obtained by defining a new color table, as shown below. The colors can be defined by HEX values or by names accepted as R color codes.
```{r, tidy = "styler", out.width = "80%", out.height = "80%", fig.align="center", fig.cap="Example of Anderson Land Classification Scheme use in sits (Source: Authors)."}
# Define a color table based on the Anderson Land Classification System
us_nlcd <- tibble::tibble(name = character(), color = character())
us_nlcd <- us_nlcd %>% 
  tibble::add_row(name = "Urban Built Up", color =  "#85929E") %>% 
  tibble::add_row(name = "Agricultural Land", color = "#F0B27A") %>% 
  tibble::add_row(name = "Rangeland", color = "#F1C40F") %>% 
  tibble::add_row(name = "Forest Land", color = "#27AE60") %>% 
  tibble::add_row(name = "Water", color = "#2980B9") %>% 
  tibble::add_row(name = "Wetland", color = "#D4E6F1") %>% 
  tibble::add_row(name = "Barren Land", color = "#FDEBD0") %>% 
  tibble::add_row(name = "Tundra", color = "#EBDEF0") %>% 
  tibble::add_row(name = "Snow and Ice", color = "#F7F9F9")
# Load the color table into `sits`
sits_colors_set(us_nlcd)
# Show the new color table used by sits
sits_colors_show()
```

The original default `sits` color table can be restored using `sits_colors_reset()`. 

```{r, eval = TRUE, echo = FALSE, warning = FALSE, message = FALSE} 
# Reset the color table
sits_colors_reset()
```

As an alternative, a legend can be used directly as a parameter to `plot()`. Please see the example provided in Section "Map Reclassification" in Chapter [Image classification in data cubes](https://e-sensing.github.io/sitsbook/image-classification-in-data-cubes.html). 

## Exporting data to JSON{-}

Both the data cube and the time series tibble can be exported to exchange formats such as JSON.

```{r, tidy = "styler", eval = FALSE}
library(jsonlite)
# Export the data cube to JSON
jsonlite::write_json(
  x = s2_20LKP_cube_MPC,
  path = "./data_cube.json",
  pretty = TRUE)

# Export the time series to JSON
jsonlite::write_json(
  x = samples_prodes_4classes,
  path = "./time_series.json",
  pretty = TRUE)
```

